<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在vultr上布署 l2tp-ipsec vpn | Tiny fun</title>
    <meta name="description" content="Make tiny fun">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.2c6316fa.css" as="style"><link rel="preload" href="/blog/assets/js/app.b7d27c45.js" as="script"><link rel="preload" href="/blog/assets/js/10.6bb7b014.js" as="script"><link rel="prefetch" href="/blog/assets/js/4.89497dea.js"><link rel="prefetch" href="/blog/assets/js/2.131ec6da.js"><link rel="prefetch" href="/blog/assets/js/3.2e80d126.js"><link rel="prefetch" href="/blog/assets/js/5.c43a2415.js"><link rel="prefetch" href="/blog/assets/js/6.83bffa3b.js"><link rel="prefetch" href="/blog/assets/js/7.96537a68.js"><link rel="prefetch" href="/blog/assets/js/8.2a15f53f.js"><link rel="prefetch" href="/blog/assets/js/9.69eab9b2.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.2c6316fa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Tiny fun</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h2 id="old-time"><a href="#old-time" aria-hidden="true" class="header-anchor">#</a> Old time</h2> <p>荒废了半年的vpn，终于在前两天重新搞个东京的vps，跟着这篇<a href="https://segmentfault.com/a/1190000006125737" target="_blank" rel="noopener noreferrer">文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>搭了起来，居然好了，mac ipad android都可以连上，终于再次连接世界。速度体验了下还比较快，流畅看youtube高清视频，也稳定很多。</p> <p>比起以前的l2tp，多了一个密钥填写项，看回以前那个<a href="https://www.digitalocean.com/community/tutorials/how-to-setup-your-own-vpn-with-pptp" target="_blank" rel="noopener noreferrer">DigitalOcean的文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 状态已经是 <em>Deprecated</em> 了，虽然好过一段时间，但经常会被重置连接，同样是vultr的东京主机，稳定性一般。</p> <h2 id="小问题"><a href="#小问题" aria-hidden="true" class="header-anchor">#</a> 小问题</h2> <ol><li><p>/etc/ppp/options.xl2tpd</p> <p>re-mschap-v2，这一行由于用了 vi 来编辑，没先打 i 导致 require 前面几个字母缺失了，发现日志有错，于是google一下。居然也有同道中人，世界真小，错都错得一毛一样</p></li> <li><p>xl2tpd 下载</p> <p>由于yum没有源，所以需要手动下载一下。原文直接就给了链接，觉得搞个新版本可能会好点，就上 <a href="http://centos.pkgs.org" target="_blank" rel="noopener noreferrer">centos.pkgs.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 搜xl2tpd，找到对应的系统版本下载装上</p></li> <li><p>日志</p> <div class="language- extra-class"><pre class="language-text"><code>cd /var/log
tailf messages
</code></pre></div></li> <li><p>来个重启脚本，方便以后定时重启</p> <div class="language- extra-class"><pre class="language-text"><code>ipsec setup restart
service xl2tpd restart
sysctl -p 
</code></pre></div></li></ol> <h2 id="小米路由"><a href="#小米路由" aria-hidden="true" class="header-anchor">#</a> 小米路由</h2> <p>虽然使用这个l2tp使用起来很方便，不用装任何软件，手机 pc mac 都能直接使用。win10看了下是有自带的智能切换流量的功能，不过mac和手机，就少了这个原生支持。</p> <p><img src="/assets/imgs/mi_route.png" alt="miroute"></p> <p>小米路由支持l2tp的链接，神奇的是它没有共享密钥的设定，一开始还以为不行。鬼使神差的试了下，居然能连上，我就开始怀疑是不是根本没有用到ipsec。</p> <p>验证了下，发现之前设置过vpn并填了共享密钥的设备能连上vpn，如果未在设备上设置过密钥就不行。未太明白原理，倒也是稳定可用，足矣。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/10.6bb7b014.js" defer></script><script src="/blog/assets/js/app.b7d27c45.js" defer></script>
  </body>
</html>
